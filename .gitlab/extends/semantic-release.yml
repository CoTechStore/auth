.semantic-release:image:
  image: python:3.12-alpine


.semantic-release:script:
  before_script:
    - apk add --no-cache git
    - pip install python-semantic-release
    - git config --global user.email "antonakuev945@gmail.com"
    - git config --global user.name "Anton Akuev"
    - git remote set-url origin "$CI_REPOSITORY_URL"
    - git fetch --tags
  script:
    - echo "Run Semantic Release"
    - semantic-release version --skip-build
    - VERSION=$(semantic-release version --print)
    - echo "Version project -> $VERSION"
    - echo "VERSION=$VERSION" > version.env
  after_script:
    - echo "Semantic Release done!"

.semantic-release:artifact:
  artifacts:
    reports:
      dotenv: version.env

.semantic-release:retry:
  retry:
    max: 2
    when:
      - runner_system_failure
      - stuck_or_timeout_failure

.semantic-release:only-main:when-manual:
  only:
    - main
  when: manual
